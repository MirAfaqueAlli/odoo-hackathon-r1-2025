<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StackIt - A Minimal Q&A Forum Platform</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
    <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #fafbfc;
            color: #1a1a1a;
            line-height: 1.6;
        }

        .header {
            background: #ffffff;
            border-bottom: 1px solid #e1e5e9;
            padding: 0.8rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }

        .header .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #0066cc;
            text-decoration: none;
        }

        .nav-stat-number {
            font-weight: 600;
            color: #0066cc;
        }

        .nav-stat {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .nav-stats {
            display: flex;
            gap: 24px;
            font-size: 14px;
            color: #6a737c;
        }

        .user-section {
            display: flex;
            align-items: center;
            gap: 16px;
            position: relative;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-name {
            font-weight: 500;
            color: #1a1a1a;
        }

        .login-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: 8px;
        }

        .google-signin-wrapper {
            min-width: 200px;
            height: 40px;
        }

        .google-signin {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #ffffff;
            color: #3c4043;
            border: 1px solid #dadce0;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            font-family: inherit;
        }

        .google-signin:hover {
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-color: #d2d6da;
        }

        .google-icon {
            width: 18px;
            height: 18px;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #6a737c;
            cursor: pointer;
            font-size: 14px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .logout-btn:hover {
            background: #f8f9fa;
            color: #3c4043;
        }

        .auth-required {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 16px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .disabled-form {
            opacity: 0.5;
            pointer-events: none;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 32px 20px;
        }

        .ask-section {
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            padding: 24px;
            margin-bottom: 24px;
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #1a1a1a;
            font-size: 14px;
        }

        input[type="text"], textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d6d9dc;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.2s ease;
            background: #ffffff;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.5;
        }

        .btn {
            background: #0066cc;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .btn:hover {
            background: #0052a3;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .questions-section {
            background: #ffffff;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            overflow: hidden;
        }

        .questions-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e1e5e9;
            background: #f8f9fa;
        }

        .question-card {
            border-bottom: 1px solid #e1e5e9;
            padding: 24px;
            transition: background-color 0.2s ease;
        }

        .question-card:last-child {
            border-bottom: none;
        }

        .question-card:hover {
            background: #f8f9fa;
        }

        .question-title {
            font-size: 16px;
            font-weight: 600;
            color: #0066cc;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .question-content {
            color: #3c4043;
            margin-bottom: 16px;
            font-size: 14px;
            line-height: 1.5;
        }

        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #6a737c;
            margin-bottom: 16px;
        }

        .category-tag {
            background: #e8f0fe;
            color: #0066cc;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .answers-section {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #e1e5e9;
        }

        .answers-header {
            font-size: 14px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 12px;
        }

        .answer {
            background: #f8f9fa;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 6px;
            border-left: 3px solid #0066cc;
        }

        .answer-content {
            font-size: 14px;
            color: #3c4043;
            margin-bottom: 8px;
        }

        .answer-meta {
            font-size: 12px;
            color: #6a737c;
        }

        .answer-form {
            margin-top: 16px;
        }

        .answer-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d6d9dc;
            border-radius: 6px;
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .answer-input:focus {
            outline: none;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .answer-btn {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .answer-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: #6a737c;
        }

        .empty-state h3 {
            font-size: 18px;
            color: #3c4043;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .empty-state p {
            font-size: 14px;
        }

        /* Notification Styles */
        .notification-icon {
            position: relative;
            cursor: pointer;
            padding: 8px;
            margin-right: 8px;
            display: flex;
            align-items: center;
        }

        .notification-icon svg {
            width: 24px;
            height: 24px;
            fill: #6a737c;
        }

        .notification-count {
            position: absolute;
            top: 0;
            right: 0;
            background: #ff4d4f;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .notification-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 1px solid #e1e5e9;
            display: none;
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-dropdown.show {
            display: block;
            animation: fadeInDown 0.2s ease-out;
        }

        .notification-header {
            padding: 12px 16px;
            border-bottom: 1px solid #e1e5e9;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .mark-all-read {
            font-size: 12px;
            color: #0066cc;
            cursor: pointer;
            font-weight: normal;
        }

        .notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid #e1e5e9;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-item:hover {
            background-color: #f8f9fa;
        }

        .notification-item.unread {
            background-color: #f0f7ff;
        }

        .notification-item.unread:hover {
            background-color: #e6f2ff;
        }

        .notification-content {
            font-size: 13px;
            color: #3c4043;
            margin-bottom: 4px;
        }

        .notification-meta {
            font-size: 11px;
            color: #6a737c;
        }

        .notification-empty {
            padding: 24px 16px;
            text-align: center;
            color: #6a737c;
            font-size: 13px;
        }

        /* User Profile Styles */
        .user-profile {
            position: relative;
            cursor: pointer;
        }

        .profile-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .profile-avatar:hover {
            transform: scale(1.05);
        }

        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 280px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid #e1e5e9;
            display: none;
            z-index: 1000;
            margin-top: 8px;
        }

        .profile-dropdown.show {
            display: block;
            animation: fadeInDown 0.2s ease-out;
        }

        .profile-header {
            padding: 16px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-header-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
        }

        .profile-header-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            color: #1a1a1a;
            font-size: 16px;
            margin-bottom: 2px;
        }

        .profile-email {
            color: #6a737c;
            font-size: 13px;
        }

        .profile-menu {
            padding: 8px 0;
        }

        .profile-menu-item {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #3c4043;
            font-size: 14px;
            transition: background-color 0.2s;
            text-decoration: none;
        }

        .profile-menu-item:hover {
            background-color: #f8f9fa;
        }

        .profile-menu-item svg {
            width: 20px;
            height: 20px;
            fill: #6a737c;
        }

        .profile-divider {
            height: 1px;
            background: #e1e5e9;
            margin: 8px 0;
        }

        /* Profile Page Styles */
        .profile-page {
            display: none;
            padding: 32px 0;
        }

        .profile-page.active {
            display: block;
        }

        .profile-cover {
            height: 200px;
            background: linear-gradient(45deg, #0066cc, #0052a3);
            border-radius: 12px;
            margin-bottom: -64px;
        }

        .profile-main {
            background: white;
            border-radius: 12px;
            border: 1px solid #e1e5e9;
            padding: 24px;
            margin-top: -24px;
        }

        .profile-main-header {
            display: flex;
            align-items: flex-end;
            gap: 24px;
            margin-bottom: 24px;
        }

        .profile-large-avatar {
            width: 128px;
            height: 128px;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-top: -64px;
        }

        .profile-stats {
            display: flex;
            gap: 32px;
            margin-top: 24px;
        }

        .profile-stat {
            text-align: center;
        }

        .profile-stat-number {
            font-size: 24px;
            font-weight: 600;
            color: #0066cc;
        }

        .profile-stat-label {
            font-size: 14px;
            color: #6a737c;
        }

        .profile-bio {
            margin: 24px 0;
            color: #3c4043;
            font-size: 15px;
            line-height: 1.6;
        }

        .profile-section {
            margin-top: 32px;
        }

        .profile-section-title {
            font-size: 18px;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 16px;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }
            
            .ask-section, .questions-section {
                border-radius: 0;
                border-left: none;
                border-right: none;
            }

            .header .container {
                padding: 0 16px;
            }

            .nav-stats {
                display: none; /* Hide stats on mobile to save space */
            }

            .google-signin-wrapper {
                min-width: 160px;
            }

            .question-card {
                padding: 20px 16px;
            }
        }

        /* Subtle animations */
        .question-card, .ask-section, .questions-section {
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Rich Text Editor Styles */
        .tox-tinymce {
            border-radius: 6px !important;
            border-color: #d6d9dc !important;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1) !important;
        }

        .tox-tinymce:focus-within {
            border-color: #0066cc !important;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1) !important;
        }

        .tox .tox-toolbar__group {
            padding: 0 4px !important;
            border-color: #e1e5e9 !important;
        }

        .tox .tox-tbtn {
            border-radius: 4px !important;
            color: #3c4043 !important;
        }

        .tox .tox-tbtn:hover {
            background-color: #f1f3f4 !important;
        }

        .tox .tox-tbtn--enabled {
            background-color: #e8f0fe !important;
            color: #0066cc !important;
        }

        .editor-wrapper {
            margin-bottom: 20px;
            position: relative;
        }

        .answer-editor {
            margin-bottom: 12px;
        }

        /* Image upload progress */
        .tox .tox-progress-bar {
            background-color: #0066cc !important;
        }

        /* Emoji picker styles */
        .tox .tox-emoji-picker {
            border-radius: 8px !important;
            border-color: #e1e5e9 !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }

        .tox .tox-collection__item {
            border-radius: 4px !important;
        }

        .tox .tox-collection__item--active {
            background-color: #e8f0fe !important;
        }

        /* Format dropdown */
        .tox .tox-collection--list .tox-collection__item {
            padding: 6px 8px !important;
        }

        .tox .tox-collection--list .tox-collection__item--enabled {
            background-color: #e8f0fe !important;
        }

        /* Color picker */
        .tox .tox-swatches {
            border-radius: 6px !important;
        }

        .tox .tox-swatch {
            border-radius: 4px !important;
        }

        /* Link dialog */
        .tox .tox-dialog {
            border-radius: 8px !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
        }

        .tox .tox-dialog__footer {
            border-radius: 0 0 8px 8px !important;
        }

        .tox .tox-dialog__body-nav-item {
            border-radius: 4px !important;
        }

        .tox .tox-button {
            border-radius: 6px !important;
            background-color: #0066cc !important;
            border-color: #0066cc !important;
        }

        .tox .tox-button:hover:not(:disabled) {
            background-color: #0052a3 !important;
            border-color: #0052a3 !important;
        }

        .tox .tox-button--secondary {
            background-color: #f8f9fa !important;
            border-color: #d6d9dc !important;
            color: #3c4043 !important;
        }

        .tox .tox-button--secondary:hover:not(:disabled) {
            background-color: #f1f3f4 !important;
            border-color: #d2d6da !important;
        }

        /* Responsive styles */
        @media (max-width: 768px) {
            .tox-tinymce {
                border-radius: 4px !important;
            }

            .tox .tox-toolbar__group {
                padding: 0 2px !important;
            }

            .tox .tox-tbtn {
                padding: 4px !important;
            }
        }

        /* Emoji Picker Styles */
        .emoji-picker {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: white;
            border: 1px solid #e1e5e9;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 8px;
            display: none;
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
        }

        .emoji-picker.show {
            display: grid;
        }

        .emoji-item {
            cursor: pointer;
            padding: 4px;
            text-align: center;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .emoji-item:hover {
            background-color: #f8f9fa;
        }

        /* Search Bar Styles */
        .search-container {
            flex: 1;
            max-width: 600px;
            margin: 0 20px;
            position: relative;
        }

        .search-wrapper {
            display: flex;
            align-items: center;
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .search-wrapper:focus-within {
            background: white;
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .search-input {
            flex: 1;
            border: none;
            padding: 10px 16px;
            font-size: 14px;
            background: transparent;
            width: 100%;
        }

        .search-input:focus {
            outline: none;
        }

        .search-icon {
            padding: 0 16px;
            color: #6a737c;
        }

        .search-icon svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
        }

        .search-filters {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-right: 16px;
            border-left: 1px solid #e1e5e9;
            margin-left: 8px;
        }

        .filter-btn {
            padding: 4px 8px;
            font-size: 12px;
            color: #6a737c;
            background: transparent;
            border: 1px solid #e1e5e9;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn:hover {
            background: #f1f2f3;
        }

        .filter-btn.active {
            background: #e8f0fe;
            color: #0066cc;
            border-color: #0066cc;
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 1px solid #e1e5e9;
            margin-top: 8px;
            display: none;
            z-index: 1000;
            max-height: 400px;
            overflow-y: auto;
        }

        .search-results.show {
            display: block;
            animation: fadeInDown 0.2s ease-out;
        }

        .search-result-item {
            padding: 12px 16px;
            border-bottom: 1px solid #e1e5e9;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background-color: #f8f9fa;
        }

        .search-result-title {
            font-weight: 600;
            color: #0066cc;
            margin-bottom: 4px;
        }

        .search-result-content {
            font-size: 13px;
            color: #3c4043;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .search-result-meta {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 12px;
            color: #6a737c;
        }

        .no-results {
            padding: 24px 16px;
            text-align: center;
            color: #6a737c;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .search-container {
                margin: 0 8px;
            }

            .search-filters {
                display: none;
            }
        }

        /* Voting Styles */
        .vote-buttons {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 16px;
            min-width: 40px;
        }

        .vote-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            color: #6a737c;
            transition: all 0.2s;
        }

        .vote-btn:hover {
            color: #0066cc;
        }

        .vote-btn.voted {
            color: #0066cc;
        }

        .vote-count {
            font-size: 16px;
            font-weight: 600;
            color: #3c4043;
            margin: 4px 0;
        }

        .answer-wrapper {
            display: flex;
            align-items: flex-start;
            padding: 16px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }

        .answer-wrapper.accepted {
            background-color: #e6f4ea;
            border-left: 3px solid #28a745;
        }

        .accept-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            color: #6a737c;
            margin-right: 12px;
            transition: all 0.2s;
        }

        .accept-btn:hover {
            color: #28a745;
        }

        .accept-btn.accepted {
            color: #28a745;
        }

        /* Tags Styles */
        .tags-input-wrapper {
            position: relative;
            margin-bottom: 20px;
        }

        .tags-input {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 8px;
            border: 1px solid #d6d9dc;
            border-radius: 6px;
            min-height: 42px;
            cursor: text;
        }

        .tags-input:focus-within {
            border-color: #0066cc;
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
        }

        .tag {
            display: inline-flex;
            align-items: center;
            background: #e1ecf4;
            color: #39739d;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            gap: 4px;
        }

        .tag-remove {
            cursor: pointer;
            color: #39739d;
            opacity: 0.6;
            transition: opacity 0.2s;
        }

        .tag-remove:hover {
            opacity: 1;
        }

        .tags-input input {
            border: none;
            outline: none;
            padding: 4px;
            flex: 1;
            min-width: 120px;
            font-size: 14px;
        }

        .tags-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d6d9dc;
            border-radius: 6px;
            margin-top: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            z-index: 10;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .tags-suggestions.show {
            display: block;
        }

        .tag-suggestion {
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .tag-suggestion:hover {
            background-color: #f8f9fa;
        }

        .question-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 12px 0;
        }

        .question-tag {
            background: #e1ecf4;
            color: #39739d;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .question-tag:hover {
            background-color: #d0e3f1;
        }

        .my-question {
            border-left: 3px solid #0066cc;
            background-color: #fafbff;
        }

        .my-question-badge {
            background-color: #e8f0fe;
            color: #0066cc;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 8px;
        }

        .questions-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .questions-filter {
            display: flex;
            gap: 12px;
        }

        .filter-button {
            background: none;
            border: 1px solid #d6d9dc;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            color: #6a737c;
            transition: all 0.2s;
        }

        .filter-button:hover {
            background-color: #f8f9fa;
        }

        .filter-button.active {
            background-color: #e8f0fe;
            color: #0066cc;
            border-color: #0066cc;
        }

        .empty-state button:hover {
            background-color: #0052a3 !important;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <a href="#" class="logo">StackIt</a>

            <!-- Search Bar -->
            <div class="search-container">
                <div class="search-wrapper">
                    <div class="search-icon">
                        <svg viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </div>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search questions...">
                    <div class="search-filters">
                        <button class="filter-btn active" data-filter="all">All</button>
                        <button class="filter-btn" data-filter="questions">Questions</button>
                        <button class="filter-btn" data-filter="answers">Answers</button>
                    </div>
                </div>
                <div class="search-results" id="searchResults"></div>
            </div>

            <div class="user-section">
                <div class="nav-stats">
                    <div class="nav-stat">
                        <span class="nav-stat-number" id="totalQuestions">0</span>
                        <span>questions</span>
                    </div>
                    <div class="nav-stat">
                        <span class="nav-stat-number" id="totalAnswers">0</span>
                        <span>answers</span>
                    </div>
                    <div class="nav-stat">
                        <span class="nav-stat-number" id="totalUsers">1</span>
                        <span>users</span>
                    </div>
                </div>
                
                <!-- Notification Section -->
                <div class="notification-icon" id="notificationIcon">
                    <svg viewBox="0 0 24 24">
                        <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/>
                    </svg>
                    <span class="notification-count" id="notificationCount" style="display: none">0</span>
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <span>Notifications</span>
                            <span class="mark-all-read" id="markAllRead">Mark all as read</span>
                        </div>
                        <div id="notificationList">
                            <div class="notification-empty">No notifications yet</div>
                        </div>
                    </div>
                </div>
                
                <!-- User Authentication Section -->
                <div id="authSection">
                    <div class="login-section" id="loginSection">
                        <div class="google-signin-wrapper">
                            <!-- Google Sign-In button will be rendered here -->
                        </div>
                    </div>
                    
                    <div class="user-info" id="userInfo" style="display: none;">
                        <div class="user-profile" id="userProfile">
                            <img class="profile-avatar" id="userAvatar" src="" alt="User Avatar">
                            <div class="profile-dropdown" id="profileDropdown">
                                <div class="profile-header">
                                    <img class="profile-header-avatar" id="profileHeaderAvatar" src="" alt="User Avatar">
                                    <div class="profile-header-info">
                                        <div class="profile-name" id="profileName"></div>
                                        <div class="profile-email" id="profileEmail"></div>
                                    </div>
                                </div>
                                <div class="profile-menu">
                                    <a href="#" class="profile-menu-item" onclick="showProfile()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                                        </svg>
                                        View Profile
                                    </a>
                                    <a href="#" class="profile-menu-item" onclick="editProfile()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                        </svg>
                                        Edit Profile
                                    </a>
                                    <div class="profile-divider"></div>
                                    <a href="#" class="profile-menu-item" onclick="signOut()">
                                        <svg viewBox="0 0 24 24">
                                            <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                                        </svg>
                                        Sign Out
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Profile Page -->
        <div class="profile-page" id="profilePage">
            <div class="profile-cover"></div>
            <div class="profile-main">
                <div class="profile-main-header">
                    <img class="profile-large-avatar" id="profilePageAvatar" src="" alt="User Avatar">
                    <div>
                        <h1 class="profile-name" id="profilePageName"></h1>
                        <p class="profile-email" id="profilePageEmail"></p>
                    </div>
                </div>
                
                <div class="profile-stats">
                    <div class="profile-stat">
                        <div class="profile-stat-number" id="userQuestions">0</div>
                        <div class="profile-stat-label">Questions</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-number" id="userAnswers">0</div>
                        <div class="profile-stat-label">Answers</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-number" id="userMentions">0</div>
                        <div class="profile-stat-label">Mentions</div>
                    </div>
                </div>

                <div class="profile-bio" id="userBio">
                    Click 'Edit Profile' to add your bio...
                </div>

                <div class="profile-section">
                    <h2 class="profile-section-title">Recent Questions</h2>
                    <div id="userQuestionsList"></div>
                </div>

                <div class="profile-section">
                    <h2 class="profile-section-title">Recent Answers</h2>
                    <div id="userAnswersList"></div>
                </div>
            </div>
        </div>

        <!-- Ask Question Section -->
        <div class="ask-section">
            <div id="authRequired" class="auth-required" style="display: none;">
                <span>⚠️</span>
                <span>Please sign in with Google to ask questions and post answers.</span>
            </div>
            <h2 class="section-title">Ask a Question</h2>
            <form id="questionForm">
                <div class="form-group">
                    <label for="questionTitle">Title</label>
                    <input type="text" id="questionTitle" placeholder="What's your question?" required>
                </div>
                
                <div class="form-group">
                    <label for="questionContent">Description</label>
                    <div class="editor-wrapper">
                        <textarea id="questionContent" placeholder="Provide more details about your question..."></textarea>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="questionTags">Tags</label>
                    <div class="tags-input-wrapper">
                        <div class="tags-input" id="tagsInput">
                            <input type="text" placeholder="Add up to 5 tags..." id="tagInput">
                        </div>
                        <div class="tags-suggestions" id="tagSuggestions"></div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="questionCategory">Category</label>
                    <select id="questionCategory" required>
                        <option value="">Choose a category</option>
                        <option value="Math">Math</option>
                        <option value="Science">Science</option>
                        <option value="English">English</option>
                        <option value="History">History</option>
                        <option value="Geography">Geography</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                
                <button type="submit" class="btn">Post Question</button>
            </form>
        </div>

        <!-- Questions Section -->
        <div class="questions-section">
            <div class="questions-header">
                <h2 class="section-title">Recent Questions</h2>
                <div class="questions-filter">
                    <button class="filter-button active" onclick="showAllQuestions()">All Questions</button>
                    <button class="filter-button" onclick="showMyQuestions()" id="myQuestionsBtn" style="display: none;">My Questions</button>
                </div>
            </div>
            <div id="questionsList">
                <div class="empty-state">
                    <h3>No questions yet</h3>
                    ${currentUser ? 
                        '<p>Ask your first question to get started!</p>' :
                        '<p>Sign in to ask questions and join the community!</p>'
                    }
                </div>
            </div>
        </div>
    </div>

    <script>
        // Authentication state
        let currentUser = null;
        
        // Simple data storage (in real app, this would be a database)
        let questions = [];
        let questionIdCounter = 1;

        // DOM elements
        const questionForm = document.getElementById('questionForm');
        const questionsList = document.getElementById('questionsList');
        const totalQuestionsEl = document.getElementById('totalQuestions');
        const totalAnswersEl = document.getElementById('totalAnswers');
        const loginSection = document.getElementById('loginSection');
        const userInfo = document.getElementById('userInfo');
        const authRequired = document.getElementById('authRequired');

        // Initialize Google Sign-In
        function initializeGoogleAuth() {
            google.accounts.id.initialize({
                client_id: 'YOUR_GOOGLE_CLIENT_ID', // You'll need to replace this with your actual Google Client ID
                callback: handleCredentialResponse
            });
            google.accounts.id.renderButton(
                document.querySelector('.google-signin-wrapper'),
                { 
                    type: 'standard',
                    theme: 'outline',
                    size: 'large',
                    text: 'signin_with',
                    shape: 'rectangular',
                    logo_alignment: 'left',
                    width: document.querySelector('.google-signin-wrapper').offsetWidth
                }
            );
        }

        // Handle Google Sign-In Response
        function handleCredentialResponse(response) {
            // Decode the credential response
            const responsePayload = jwt_decode(response.credential);
            
            const user = {
                id: responsePayload.sub,
                name: responsePayload.name,
                email: responsePayload.email,
                picture: responsePayload.picture
            };
            
            handleAuthSuccess(user);
        }

        // Handle successful authentication
        function handleAuthSuccess(user) {
            currentUser = {
                ...user,
                bio: '',
                questions: [],
                answers: [],
                mentions: []
            };
            
            // Update UI
            document.getElementById('profileName').textContent = user.name;
            document.getElementById('profileEmail').textContent = user.email;
            document.getElementById('profileHeaderAvatar').src = user.picture;
            document.getElementById('userAvatar').src = user.picture;
            document.getElementById('profilePageName').textContent = user.name;
            document.getElementById('profilePageEmail').textContent = user.email;
            document.getElementById('profilePageAvatar').src = user.picture;
            
            // Show/hide appropriate sections
            loginSection.style.display = 'none';
            userInfo.style.display = 'flex';
            authRequired.style.display = 'none';
            document.getElementById('myQuestionsBtn').style.display = 'block';
            
            // Enable form
            questionForm.classList.remove('disabled-form');
            
            // Load user's questions
            loadUserQuestions();
            updateUserStats();
            console.log('User signed in:', user);
        }

        // Load user's questions
        function loadUserQuestions() {
            const userQuestions = questions.filter(q => q.author === currentUser.name);
            displayQuestions(userQuestions);
        }

        // Profile Dropdown Toggle
        const userProfile = document.getElementById('userProfile');
        const profileDropdown = document.getElementById('profileDropdown');

        userProfile.addEventListener('click', (e) => {
            e.stopPropagation();
            profileDropdown.classList.toggle('show');
            notificationDropdown.classList.remove('show'); // Hide notifications if open
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', (e) => {
            if (!profileDropdown.contains(e.target)) {
                profileDropdown.classList.remove('show');
            }
        });

        // Show Profile Page
        function showProfile() {
            document.querySelector('.ask-section').style.display = 'none';
            document.querySelector('.questions-section').style.display = 'none';
            document.getElementById('profilePage').style.display = 'block';
            profileDropdown.classList.remove('show');
            updateUserStats();
            displayUserContent();
        }

        // Edit Profile
        function editProfile() {
            const newBio = prompt('Enter your bio:', currentUser.bio);
            if (newBio !== null) {
                currentUser.bio = newBio;
                document.getElementById('userBio').textContent = newBio || 'Click "Edit Profile" to add your bio...';
            }
            profileDropdown.classList.remove('show');
        }

        // Update user statistics
        function updateUserStats() {
            if (!currentUser) return;

            const userQuestions = questions.filter(q => q.author === currentUser.name);
            const userAnswers = questions.reduce((count, q) => 
                count + q.answers.filter(a => a.author === currentUser.name).length, 0);
            const userMentions = questions.reduce((count, q) => {
                return count + q.answers.filter(a => 
                    a.content.includes(`@${currentUser.name}`)
                ).length;
            }, 0);

            document.getElementById('userQuestions').textContent = userQuestions.length;
            document.getElementById('userAnswers').textContent = userAnswers;
            document.getElementById('userMentions').textContent = userMentions;

            currentUser.questions = userQuestions;
        }

        // Display user's questions and answers
        function displayUserContent() {
            const userQuestionsList = document.getElementById('userQuestionsList');
            const userAnswersList = document.getElementById('userAnswersList');

            // Display user's questions
            if (currentUser.questions.length === 0) {
                userQuestionsList.innerHTML = '<div class="notification-empty">No questions asked yet</div>';
            } else {
                userQuestionsList.innerHTML = currentUser.questions.map(question => `
                    <div class="question-card">
                        <div class="question-title">${question.title}</div>
                        <div class="question-content">${question.content}</div>
                        <div class="question-meta">
                            <span class="category-tag">${question.category}</span>
                            <span>${question.timestamp}</span>
                        </div>
                    </div>
                `).join('');
            }

            // Display user's answers
            const userAnswers = questions.reduce((answers, q) => {
                const questionAnswers = q.answers
                    .filter(a => a.author === currentUser.name)
                    .map(a => ({
                        ...a,
                        questionTitle: q.title
                    }));
                return [...answers, ...questionAnswers];
            }, []);

            if (userAnswers.length === 0) {
                userAnswersList.innerHTML = '<div class="notification-empty">No answers posted yet</div>';
            } else {
                userAnswersList.innerHTML = userAnswers.map(answer => `
                    <div class="answer">
                        <div class="question-title">${answer.questionTitle}</div>
                        <div class="answer-content">${answer.content}</div>
                        <div class="answer-meta">
                            Answered on ${answer.timestamp}
                        </div>
                    </div>
                `).join('');
            }
        }

        // Modified sign out to handle profile
        function signOut() {
            currentUser = null;
            
            // Update UI
            loginSection.style.display = 'flex';
            userInfo.style.display = 'none';
            authRequired.style.display = 'flex';
            document.getElementById('profilePage').style.display = 'none';
            document.getElementById('myQuestionsBtn').style.display = 'none';
            document.querySelector('.ask-section').style.display = 'block';
            document.querySelector('.questions-section').style.display = 'block';
            
            // Disable form
            questionForm.classList.add('disabled-form');
            
            console.log('User signed out');
        }

        // Check authentication before form submission
        function checkAuth() {
            if (!currentUser) {
                authRequired.style.display = 'flex';
                questionForm.classList.add('disabled-form');
                return false;
            }
            return true;
        }

        // Add question
        questionForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!checkAuth()) {
                return;
            }
            
            const title = document.getElementById('questionTitle').value;
            const content = document.getElementById('questionContent').value;
            const category = document.getElementById('questionCategory').value;
            
            if (title && content && category) {
                const question = {
                    id: questionIdCounter++,
                    title: title,
                    content: content,
                    category: category,
                    author: currentUser.name,
                    authorAvatar: currentUser.picture,
                    answers: [],
                    timestamp: new Date().toLocaleString()
                };
                
                questions.unshift(question);
                displayQuestions();
                updateStats();
                questionForm.reset();
            }
        });

        // Display questions
        function displayQuestions(questionsToDisplay = null) {
            // If no specific questions are provided, show all questions
            const displayedQuestions = questionsToDisplay || questions;

            if (displayedQuestions.length === 0) {
                const emptyStateMessage = currentUser ? {
                    title: "Start the Conversation",
                    message: "Ask your first question to get started!",
                    icon: `<svg viewBox="0 0 24 24" width="48" height="48" style="fill: #0066cc; margin-bottom: 16px;">
                            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12zM7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                          </svg>`
                } : {
                    title: "Join the Community",
                    message: "Sign in to ask questions and share your knowledge!",
                    icon: `<svg viewBox="0 0 24 24" width="48" height="48" style="fill: #6a737c; margin-bottom: 16px;">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                          </svg>`
                };

                questionsList.innerHTML = `
                    <div class="empty-state" style="
                        padding: 48px 24px;
                        text-align: center;
                        background: #ffffff;
                        border-radius: 8px;
                        margin: 20px 0;
                        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
                    ">
                        ${emptyStateMessage.icon}
                        <h3 style="
                            font-size: 20px;
                            color: #1a1a1a;
                            margin-bottom: 8px;
                            font-weight: 600;
                        ">${emptyStateMessage.title}</h3>
                        <p style="
                            font-size: 15px;
                            color: #6a737c;
                            max-width: 400px;
                            margin: 0 auto;
                            line-height: 1.6;
                        ">${emptyStateMessage.message}</p>
                        ${currentUser ? `
                            <button onclick="focusQuestionForm()" style="
                                background: #0066cc;
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 6px;
                                font-size: 14px;
                                font-weight: 500;
                                margin-top: 24px;
                                cursor: pointer;
                                transition: background-color 0.2s;
                            ">Ask a Question</button>
                        ` : `
                            <button onclick="showLoginPrompt()" style="
                                background: #0066cc;
                                color: white;
                                border: none;
                                padding: 10px 20px;
                                border-radius: 6px;
                                font-size: 14px;
                                font-weight: 500;
                                margin-top: 24px;
                                cursor: pointer;
                                transition: background-color 0.2s;
                            ">Sign In Now</button>
                        `}
                    </div>
                `;
                return;
            }

            questionsList.innerHTML = displayedQuestions.map(question => `
                <div class="question-card ${question.author === currentUser?.name ? 'my-question' : ''}" data-id="${question.id}">
                    <div class="question-title">${question.title}</div>
                    <div class="question-content">${question.content}</div>
                    <div class="question-tags">
                        ${question.tags.map(tag => `
                            <a href="#" class="question-tag" onclick="filterByTag('${tag}')">${tag}</a>
                        `).join('')}
                    </div>
                    <div class="question-meta">
                        <span class="category-tag">${question.category}</span>
                        <span>Asked by ${question.author} on ${question.timestamp}</span>
                        ${question.author === currentUser?.name ? 
                            '<span class="my-question-badge">My Question</span>' : 
                            ''}
                    </div>
                    
                    <div class="answers-section">
                        <div class="answers-header">
                            ${question.answers.length} ${question.answers.length === 1 ? 'Answer' : 'Answers'}
                        </div>
                        <div class="answers-list">
                            ${question.answers.map(answer => `
                                <div class="answer-wrapper ${answer.accepted ? 'accepted' : ''}" data-id="${answer.id}">
                                    <div class="vote-buttons">
                                        <button class="vote-btn ${answer.userVote === 1 ? 'voted' : ''}" 
                                                onclick="voteAnswer(${question.id}, ${answer.id}, 1)">
                                            <svg viewBox="0 0 24 24" width="24" height="24">
                                                <path d="M12 4l-8 8h6v8h4v-8h6z"/>
                                            </svg>
                                        </button>
                                        <span class="vote-count">${answer.votes || 0}</span>
                                        <button class="vote-btn ${answer.userVote === -1 ? 'voted' : ''}" 
                                                onclick="voteAnswer(${question.id}, ${answer.id}, -1)">
                                            <svg viewBox="0 0 24 24" width="24" height="24">
                                                <path d="M12 20l-8-8h6V4h4v8h6z"/>
                                            </svg>
                                        </button>
                                    </div>
                                    ${question.author === currentUser?.name ? `
                                        <button class="accept-btn ${answer.accepted ? 'accepted' : ''}" 
                                                onclick="acceptAnswer(${question.id}, ${answer.id})">
                                            <svg viewBox="0 0 24 24" width="24" height="24">
                                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                                            </svg>
                                        </button>
                                    ` : ''}
                                    <div class="answer-content">
                                        <div>${answer.content}</div>
                                        <div class="answer-meta">
                                            Answered by ${answer.author} on ${answer.timestamp}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="answer-form" ${!currentUser ? 'style="display: none;"' : ''}>
                            <div class="answer-editor">
                                <textarea class="answer-input" placeholder="Write your answer..." 
                                          data-question-id="${question.id}"></textarea>
                            </div>
                            <button class="answer-btn" onclick="addAnswer(${question.id})">
                                Submit Answer
                            </button>
                        </div>
                        
                        ${!currentUser ? '<div class="auth-required"><span>⚠️</span><span>Please sign in to answer questions.</span></div>' : ''}
                    </div>
                </div>
            `).join('');

            // Initialize answer editors after displaying questions
            initializeAnswerEditors();
        }

        // Update statistics
        function updateStats() {
            const totalAnswers = questions.reduce((sum, q) => sum + q.answers.length, 0);
            totalQuestionsEl.textContent = questions.length;
            totalAnswersEl.textContent = totalAnswers;
        }

        // Notification System
        let notifications = [];
        let unreadCount = 0;

        // Notification DOM elements
        const notificationIcon = document.getElementById('notificationIcon');
        const notificationDropdown = document.getElementById('notificationDropdown');
        const notificationCount = document.getElementById('notificationCount');
        const notificationList = document.getElementById('notificationList');
        const markAllRead = document.getElementById('markAllRead');

        // Toggle notification dropdown
        notificationIcon.addEventListener('click', (e) => {
            e.stopPropagation();
            notificationDropdown.classList.toggle('show');
        });

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!notificationDropdown.contains(e.target)) {
                notificationDropdown.classList.remove('show');
            }
        });

        // Mark all notifications as read
        markAllRead.addEventListener('click', () => {
            notifications.forEach(notification => notification.read = true);
            updateNotifications();
        });

        // Add new notification
        function addNotification(content, type, relatedId) {
            const notification = {
                id: Date.now(),
                content,
                type,
                relatedId,
                timestamp: new Date(),
                read: false
            };
            
            notifications.unshift(notification);
            updateNotifications();
        }

        // Update notifications UI
        function updateNotifications() {
            unreadCount = notifications.filter(n => !n.read).length;
            
            // Update count badge
            notificationCount.textContent = unreadCount;
            notificationCount.style.display = unreadCount > 0 ? 'flex' : 'none';
            
            // Update notification list
            if (notifications.length === 0) {
                notificationList.innerHTML = '<div class="notification-empty">No notifications yet</div>';
                return;
            }
            
            notificationList.innerHTML = notifications.map(notification => `
                <div class="notification-item ${notification.read ? '' : 'unread'}" 
                     onclick="handleNotificationClick(${notification.id})">
                    <div class="notification-content">${notification.content}</div>
                    <div class="notification-meta">
                        ${timeAgo(notification.timestamp)}
                    </div>
                </div>
            `).join('');
        }

        // Handle notification click
        function handleNotificationClick(notificationId) {
            const notification = notifications.find(n => n.id === notificationId);
            if (notification) {
                notification.read = true;
                updateNotifications();
                
                // Scroll to related content if applicable
                if (notification.relatedId) {
                    const element = document.querySelector(`[data-id="${notification.relatedId}"]`);
                    if (element) {
                        element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }
            }
        }

        // Time ago formatter
        function timeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = Math.floor(seconds / 31536000);
            if (interval > 1) return interval + ' years ago';
            if (interval === 1) return 'a year ago';
            
            interval = Math.floor(seconds / 2592000);
            if (interval > 1) return interval + ' months ago';
            if (interval === 1) return 'a month ago';
            
            interval = Math.floor(seconds / 86400);
            if (interval > 1) return interval + ' days ago';
            if (interval === 1) return 'a day ago';
            
            interval = Math.floor(seconds / 3600);
            if (interval > 1) return interval + ' hours ago';
            if (interval === 1) return 'an hour ago';
            
            interval = Math.floor(seconds / 60);
            if (interval > 1) return interval + ' minutes ago';
            if (interval === 1) return 'a minute ago';
            
            return 'just now';
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeGoogleAuth();
            initializeSampleData();
            initializeRichTextEditors();
            
            // Initially show auth required and disable form
            authRequired.style.display = 'flex';
            questionForm.classList.add('disabled-form');
        });

        // Initialize Rich Text Editors
        function initializeRichTextEditors() {
            // Common TinyMCE configuration
            const commonConfig = {
                menubar: false,
                statusbar: false,
                plugins: [
                    'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
                    'searchreplace', 'visualblocks', 'fullscreen', 'code',
                    'insertdatetime', 'media', 'table', 'emoticons', 'wordcount'
                ],
                toolbar: 'formatselect | bold italic underline strikethrough | ' +
                        'bullist numlist | link image emoticons | ' +
                        'alignleft aligncenter alignright | forecolor backcolor | ' +
                        'undo redo | removeformat',
                content_style: `
                    body { 
                        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; 
                        font-size: 14px;
                        line-height: 1.6;
                    }
                    p { margin: 0 0 1em 0; }
                    img { max-width: 100%; height: auto; }
                    .mce-content-body[data-mce-placeholder]:not(.mce-visualblocks)::before {
                        color: #6c757d;
                        opacity: 0.6;
                    }
                `,
                formats: {
                    bold: { inline: 'strong' },
                    italic: { inline: 'em' },
                    underline: { inline: 'u' },
                    strikethrough: { inline: 'strike' }
                },
                block_formats: 'Paragraph=p; Header 1=h1; Header 2=h2; Header 3=h3',
                height: 250,
                placeholder: 'Start typing...',
                paste_data_images: true,
                automatic_uploads: true,
                images_upload_handler: handleImageUpload,
                emoticons_database: 'emojis',
                file_picker_types: 'image',
                setup: function(editor) {
                    editor.on('change', function() {
                        editor.save(); // Ensure form validation works
                    });
                }
            };

            // Initialize the question editor
            tinymce.init({
                ...commonConfig,
                selector: '#questionContent',
                height: 300,
                placeholder: 'Provide more details about your question...'
            });

            // Initialize answer editors
            function initializeAnswerEditors() {
                tinymce.remove('.answer-input'); // Remove any existing editors
                tinymce.init({
                    ...commonConfig,
                    selector: '.answer-input',
                    height: 200,
                    placeholder: 'Write your answer...',
                    toolbar: 'bold italic underline | bullist numlist | link emoticons | alignleft aligncenter alignright | undo redo' // Simplified toolbar for answers
                });
            }

            // Call this function whenever questions are displayed
            const originalDisplayQuestions = displayQuestions;
            displayQuestions = function() {
                originalDisplayQuestions();
                initializeAnswerEditors();
            };
        }

        // Handle image uploads
        function handleImageUpload(blobInfo, progress) {
            return new Promise((resolve, reject) => {
                // Check file size (max 5MB)
                if (blobInfo.blob().size > 5 * 1024 * 1024) {
                    reject('Image file too large. Maximum size is 5MB.');
                    return;
                }

                const reader = new FileReader();
                reader.onload = function() {
                    // In a real app, you'd upload to a server
                    // For demo, we'll use base64
                    resolve(reader.result);
                };
                reader.onerror = function() {
                    reject('Failed to read file');
                };
                reader.readAsDataURL(blobInfo.blob());
            });
        }

        // Modified addAnswer function to handle rich text
        function addAnswer(questionId) {
            if (!checkAuth()) {
                return;
            }
            
            const answerEditor = tinymce.get(
                document.querySelector(`textarea[data-question-id="${questionId}"]`).id
            );
            const answerContent = answerEditor.getContent();
            
            if (answerContent) {
                const question = questions.find(q => q.id === questionId);
                if (question) {
                    // Add answer
                    question.answers.push({
                        id: Date.now(),
                        content: answerContent,
                        author: currentUser.name,
                        timestamp: new Date().toLocaleString()
                    });

                    // Create notification for question author
                    if (question.author !== currentUser.name) {
                        addNotification(
                            `${currentUser.name} answered your question: "${question.title}"`,
                            'answer',
                            questionId
                        );
                    }

                    // Check for @mentions in the answer
                    const textContent = answerEditor.getContent({format: 'text'});
                    const mentions = textContent.match(/@(\w+)/g);
                    if (mentions) {
                        mentions.forEach(mention => {
                            const username = mention.substring(1);
                            if (username !== currentUser.name) {
                                addNotification(
                                    `${currentUser.name} mentioned you in an answer to "${question.title}"`,
                                    'mention',
                                    questionId
                                );
                            }
                        });
                    }

                    displayQuestions();
                    updateStats();
                    answerEditor.setContent('');
                }
            }
        }

        // Common tag suggestions
        const commonTags = [
            'javascript', 'python', 'java', 'html', 'css', 'react', 'node.js', 'angular',
            'vue.js', 'sql', 'mongodb', 'express', 'django', 'spring', 'flutter', 'ios',
            'android', 'docker', 'kubernetes', 'aws', 'azure', 'git', 'algorithms', 'security'
        ];

        // Tags handling
        const tagsInput = document.getElementById('tagsInput');
        const tagInput = document.getElementById('tagInput');
        const tagSuggestions = document.getElementById('tagSuggestions');
        let selectedTags = [];

        tagInput.addEventListener('input', function(e) {
            const value = e.target.value.trim().toLowerCase();
            if (value.length < 2) {
                tagSuggestions.classList.remove('show');
                return;
            }

            const filteredTags = commonTags.filter(tag => 
                tag.toLowerCase().includes(value) && !selectedTags.includes(tag)
            );

            if (filteredTags.length > 0) {
                tagSuggestions.innerHTML = filteredTags.map(tag => `
                    <div class="tag-suggestion" onclick="addTag('${tag}')">${tag}</div>
                `).join('');
                tagSuggestions.classList.add('show');
            } else {
                tagSuggestions.classList.remove('show');
            }
        });

        function addTag(tag) {
            if (selectedTags.length >= 5) {
                alert('Maximum 5 tags allowed');
                return;
            }

            if (!selectedTags.includes(tag)) {
                selectedTags.push(tag);
                updateTagsDisplay();
            }
            tagInput.value = '';
            tagSuggestions.classList.remove('show');
        }

        function removeTag(tag) {
            selectedTags = selectedTags.filter(t => t !== tag);
            updateTagsDisplay();
        }

        function updateTagsDisplay() {
            const tagsHtml = selectedTags.map(tag => `
                <span class="tag">
                    ${tag}
                    <span class="tag-remove" onclick="removeTag('${tag}')">&times;</span>
                </span>
            `).join('');
            tagsInput.innerHTML = tagsHtml + `<input type="text" placeholder="Add up to 5 tags..." id="tagInput">`;
            tagInput = document.getElementById('tagInput');
            setupTagInputListeners();
        }

        function setupTagInputListeners() {
            tagInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    e.preventDefault();
                    addTag(e.target.value.trim().toLowerCase());
                }
            });
        }

        // Voting system
        function voteAnswer(questionId, answerId, vote) {
            if (!checkAuth()) return;

            const question = questions.find(q => q.id === questionId);
            if (!question) return;

            const answer = question.answers.find(a => a.id === answerId);
            if (!answer) return;

            // Remove previous vote if exists
            if (answer.userVote === vote) {
                answer.votes -= vote;
                answer.userVote = 0;
            } else {
                // Remove previous vote if any
                if (answer.userVote) {
                    answer.votes -= answer.userVote;
                }
                // Add new vote
                answer.votes = (answer.votes || 0) + vote;
                answer.userVote = vote;
            }

            displayQuestions();
        }

        // Accept answer
        function acceptAnswer(questionId, answerId) {
            if (!checkAuth()) return;

            const question = questions.find(q => q.id === questionId);
            if (!question || question.author !== currentUser.name) return;

            const answer = question.answers.find(a => a.id === answerId);
            if (!answer) return;

            // Toggle accepted status
            answer.accepted = !answer.accepted;

            // Unaccept other answers
            if (answer.accepted) {
                question.answers.forEach(a => {
                    if (a.id !== answerId) {
                        a.accepted = false;
                    }
                });

                // Notify answer author
                if (answer.author !== currentUser.name) {
                    addNotification(
                        `Your answer to "${question.title}" was accepted!`,
                        'accept',
                        questionId
                    );
                }
            }

            displayQuestions();
        }

        // Filter by tag
        function filterByTag(tag) {
            const filteredQuestions = questions.filter(q => q.tags.includes(tag));
            displayQuestions(filteredQuestions);
        }

        // Modified question form submission to include tags
        questionForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!checkAuth()) {
                return;
            }
            
            const title = document.getElementById('questionTitle').value;
            const content = tinymce.get('questionContent').getContent();
            const category = document.getElementById('questionCategory').value;
            
            if (selectedTags.length === 0) {
                alert('Please add at least one tag to your question');
                return;
            }
            
            if (title && content && category) {
                const question = {
                    id: questionIdCounter++,
                    title: title,
                    content: content,
                    category: category,
                    tags: [...selectedTags],
                    author: currentUser.name,
                    authorAvatar: currentUser.picture,
                    answers: [],
                    timestamp: new Date().toLocaleString()
                };
                
                questions.unshift(question);
                loadUserQuestions(); // Show user's questions after posting
                updateStats();
                questionForm.reset();
                tinymce.get('questionContent').setContent('');
                selectedTags = [];
                updateTagsDisplay();

                // Show success message
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.innerHTML = `
                    <div style="background-color: #e6f4ea; color: #28a745; padding: 12px; border-radius: 6px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                        <svg viewBox="0 0 24 24" width="24" height="24" style="fill: currentColor;">
                            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                        </svg>
                        <span>Your question has been posted successfully!</span>
                    </div>
                `;
                questionForm.insertBefore(successMessage, questionForm.firstChild);
                
                // Remove success message after 3 seconds
                setTimeout(() => {
                    successMessage.remove();
                }, 3000);
            }
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        const searchResults = document.getElementById('searchResults');
        const filterButtons = document.querySelectorAll('.filter-btn');
        let currentFilter = 'all';
        let searchTimeout;

        // Search input handler
        searchInput.addEventListener('input', function(e) {
            clearTimeout(searchTimeout);
            const query = e.target.value.trim().toLowerCase();
            
            if (query.length < 2) {
                searchResults.classList.remove('show');
                return;
            }

            // Debounce search to avoid too many updates
            searchTimeout = setTimeout(() => {
                performSearch(query);
            }, 300);
        });

        // Filter buttons handler
        filterButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                filterButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.dataset.filter;
                
                if (searchInput.value.trim().length >= 2) {
                    performSearch(searchInput.value.trim().toLowerCase());
                }
            });
        });

        // Close search results when clicking outside
        document.addEventListener('click', function(e) {
            if (!searchResults.contains(e.target) && !searchInput.contains(e.target)) {
                searchResults.classList.remove('show');
            }
        });

        // Perform search
        function performSearch(query) {
            let results = [];
            
            // Search in questions
            if (currentFilter === 'all' || currentFilter === 'questions') {
                const questionResults = questions.filter(q => 
                    q.title.toLowerCase().includes(query) || 
                    stripHtml(q.content).toLowerCase().includes(query)
                ).map(q => ({
                    type: 'question',
                    title: q.title,
                    content: stripHtml(q.content),
                    author: q.author,
                    timestamp: q.timestamp,
                    id: q.id
                }));
                results = [...results, ...questionResults];
            }

            // Search in answers
            if (currentFilter === 'all' || currentFilter === 'answers') {
                questions.forEach(q => {
                    const answerResults = q.answers.filter(a =>
                        stripHtml(a.content).toLowerCase().includes(query)
                    ).map(a => ({
                        type: 'answer',
                        title: `Answer to: ${q.title}`,
                        content: stripHtml(a.content),
                        author: a.author,
                        timestamp: a.timestamp,
                        id: q.id
                    }));
                    results = [...results, ...answerResults];
                });
            }

            // Display results
            if (results.length === 0) {
                searchResults.innerHTML = `
                    <div class="no-results">
                        No results found for "${query}"
                    </div>
                `;
            } else {
                searchResults.innerHTML = results.map(result => `
                    <div class="search-result-item" onclick="scrollToContent('${result.id}', '${result.type}')">
                        <div class="search-result-title">${result.title}</div>
                        <div class="search-result-content">${highlightText(result.content, query)}</div>
                        <div class="search-result-meta">
                            <span>${result.type === 'question' ? 'Asked' : 'Answered'} by ${result.author}</span>
                            <span>${result.timestamp}</span>
                        </div>
                    </div>
                `).join('');
            }
            
            searchResults.classList.add('show');
        }

        // Scroll to content when clicking a search result
        function scrollToContent(id, type) {
            const element = document.querySelector(`[data-id="${id}"]`);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                element.style.backgroundColor = '#fff3cd';
                setTimeout(() => {
                    element.style.backgroundColor = '';
                }, 2000);
            }
            searchResults.classList.remove('show');
            searchInput.value = '';
        }

        // Helper function to strip HTML tags
        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }

        // Helper function to highlight matching text
        function highlightText(text, query) {
            const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            return text.replace(
                new RegExp(escapedQuery, 'gi'),
                match => `<mark style="background-color: #fff3cd; padding: 0 2px;">${match}</mark>`
            );
        }

        // Filter functions
        function showAllQuestions() {
            updateFilterButtons('All Questions');
            displayQuestions();
        }

        function showMyQuestions() {
            if (!currentUser) return;
            updateFilterButtons('My Questions');
            loadUserQuestions();
        }

        function updateFilterButtons(activeFilter) {
            const buttons = document.querySelectorAll('.filter-button');
            buttons.forEach(button => {
                button.classList.toggle('active', button.textContent === activeFilter);
            });
        }

        // Helper function to focus on question form
        function focusQuestionForm() {
            document.getElementById('questionTitle').focus();
            window.scrollTo({
                top: document.querySelector('.ask-section').offsetTop - 80,
                behavior: 'smooth'
            });
        }

        // Helper function to show login prompt
        function showLoginPrompt() {
            const googleSignInButton = document.querySelector('.google-signin-wrapper div');
            if (googleSignInButton) {
                googleSignInButton.click();
            }
        }
    </script>
</body>
</html>